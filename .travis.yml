language: cpp
compiler: gcc

matrix:
  include:
    - name: "GCC8"
      os: linux
      compiler: gcc-8
      env:
        - CCOMPILER=gcc-8
        - ASMCOMPILER=g++-8
        - CPPCOMPILER=g++-8
        - DYNAMICLINKER=g++-8
        - APPLINKER=g++-8
        - BUILDMODULES="all"
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-8
            - nasm
            - python3
            - python3-pip
            - libx11-dev
            - libgl1-mesa-dev
            - libglu1-mesa-dev
            - libxi-dev
            
    - name: "Clang6"
      os: linux
      compiler: clang-6.0
      env:
        - CCOMPILER=clang-6.0
        - ASMCOMPILER=clang++-6.0
        - CPPCOMPILER=clang++-6.0
        - DYNAMICLINKER=clang++-6.0
        - APPLINKER=clang++-6.0
        - BUILDMODULES="all"
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-trusty-6.0
            - sourceline: 'deb http://apt.llvm.org/trusty/ llvm-toolchain-trusty-6.0 main'
              key_url: 'https://apt.llvm.org/llvm-snapshot.gpg.key'
          packages:
            - clang-6.0
            - llvm-6.0-dev  # for LLVMgold.so
            - binutils-gold
            - binutils-dev
            - g++-8
            - nasm
            - python3
            - python3-pip
            - libx11-dev
            - libgl1-mesa-dev
            - libglu1-mesa-dev
            - libxi-dev

before_install:
  - mkdir tmp
  - cd tmp
  - mkdir include
  - wget -O boost.tar.bz2 https://dl.bintray.com/boostorg/release/1.70.0/source/boost_1_70_0.tar.bz2
  - tar xjf boost.tar.bz2
  - mv ./boost_1_70_0/boost ./include/
  - export CPP_DEPENDENCY_PATH=$(pwd)
  - wget -O ispc.tar.gz https://sourceforge.net/projects/ispcmirror/files/v1.11.0/ispc-v1.11.0-linux.tar.gz/download
  - tar xzf ispc.tar.gz
  - export ISPCCOMPILER=$(find $(pwd) -type f -name ispc)
  - cd ..

before_script:
  - echo $CPP_DEPENDENCY_PATH
  - $CPPCOMPILER --version
  - $ISPCCOMPILER --version
  - python3 --version
  - pip install chardet
  - nasm -v

script:
  - python3 xzbuild.py rebuild $BUILDMODULES
  - python3 xzbuild.py rebuildall "SIMDTest" Release
  - ./x64/Release/SIMDTest
